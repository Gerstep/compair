<div ng-controller="CourseQuestionsController" class="course-screen">
	
	<div class="row">
		<header class="col-sm-6">
			<h1><i class="fa fa-book"></i> {{course.name}}</h1>
			<div class="intro-text"
			     ng-bind-html="course.description">
			</div>
		</header>
		<div class="col-sm-6 sub-nav">
			<span ng-if="canCreateQuestions">
				<a ng-href="#/course/{{course.id}}/question/create" 
					class="btn btn-primary" id="stepNav">
					<i class="fa fa-plus"></i>
					Add Question
				</a>
			</span>
			<span ng-if="canEditCourse">
				<a ng-href="#/course/{{course.id}}/configure" class="btn btn-primary">
					<i class="fa fa-edit"></i>
					Edit Course
				</a>
				<a ng-href="#/course/{{course.id}}/user" class="btn btn-primary">
					<i class="fa fa-users"></i>
					Manage Users
				</a>
			</span>
			<span ng-if="canCreateQuestions">
				<a ng-href="#/course/{{course.id}}/gradebook" 
					class="btn btn-primary">
					<i class="glyphicon glyphicon-tasks"></i>
					See Activity
				</a>
			</span>
		</div>
	</div>
	
	<form class="form-inline searchCourse" role="search" ng-show="questions.length">
		<div class="form-group pull-right">
			<input class="form-control" type="text" ng-model="questionFilter.title"
				placeholder="Search question titles">
		</div>
	</form>
	
	<h2>Course questions</h2>
	
	<div ng-if="!questions.length">
		<hr />
		<p>No questions currently posted.</p>
		<p ng-if="canCreateQuestions">Would you like to <a ng-href="#/course/{{course.id}}/question/create">add a question</a>?</p>
	</div>
	
	<!-- Questions List -->
	<div class="row each-question"
		ng-repeat="(key, question) in questions | filter:questionFilter">
		
		<!-- Question Display -->
		<div class="col-sm-9 media">

			<!-- Question Info -->
			<div class="media-body">
				
				<!-- Title -->
				<a ng-href="#/course/{{course.id}}/question/{{question.id}}">
					<h3 class="media-heading">
						<i class="fa fa-comments"></i> {{question.title}} &raquo;
					</h3>
				</a>
				
				<!-- Details -->
				<div class="question-desc">
					<div mathjax
					     ng-bind-html="question.post.content">
					</div>
					<!-- Attachment -->
					<p ng-if="question.post.files.length">
						See question details:
						<span ng-repeat="file in question.post.files">
							<a target="_blank" ng-href="#/course/{{courseId}}/question/{{question.id}}/post/{{question.post.id}}">{{file.alias}} <i class="fa fa-file-pdf-o"></i></a>
						</span>
					</p>
				</div>
				
				<!-- Metadata -->
				<ul class="list-inline">
					<!-- Edit Link -->
					<li ng-if="canManagePosts || question.post.user.id == loggedInUserId">	
						<a ng-href="#/course/{{course.id}}/question/{{question.id}}/edit" title="Edit">
							Edit
						</a> 
					</li>
					<!-- Time Posted and Author -->
					<li>
						Posted by 
						<a ng-href="#/user/{{question.post.user.id}}">
							{{question.post.user.displayname}}
							<span ng-if="canManagePosts && question.post.user.fullname">
								({{question.post.user.fullname}})
							</span>
							<span ng-if="canManagePosts && !question.post.user.fullname">
								({{question.post.user.username}})
							</span>
						</a>
					</li>
					<!-- Total Answers -->
					<li title="{{question.answers_count}} answers">
						{{question.answers_count}} answer<span ng-if="question.answers_count != 1">s</span>
					</li>
					<!-- Total Comments -->
					<li title="{{question.comments_count}} comments"> 
						{{question.comments_count}} comment<span ng-if="question.comments_count != 1">s</span>
					</li>
					<!-- Evaluations Counter (for students) -->
					<li ng-if="!canManagePosts && question.judging_period" ng-class="{'label label-warning': (question.left + question.selfeval_left) > 0}">
						{{question.left + question.selfeval_left}} evaluation<span ng-if="(question.left + question.selfeval_left) != 1">s</span> needed from you
					</li>
					<!-- Answers Active (for instructors) -->
					<li ng-class="{'label label-warning': question.answer_period}" ng-if="canManagePosts">
						<span ng-if="question.answer_period">Students answering until {{question.answer_end | amDateFormat: 'MMM D'}}</span>
						<span ng-if="!question.answer_period">Students answer {{question.answer_start | amDateFormat: 'MMM D'}}-{{question.answer_end | amDateFormat: 'MMM D'}}</span>
					</li>
					<li ng-if="canManagePosts || question.post.user.id == loggedInUserId">
						<a confirmation-needed="deleteQuestion(key, course.id, question.id)" keyword="question" title="Delete">
							<i class="fa fa-trash-o"></i>
						</a>
					</li>
				</ul>
				
			</div>
			
		</div>
		
		<!-- Question Controls -->
		<div class="col-sm-3 text-right">
			<a class="btn btn-success" title="Answer Question"
				ng-href="#/course/{{course.id}}/question/{{question.id}}/answer/create" ng-show="!answered[question.id] && (canManagePosts || question.answer_period)">
				Answer
			</a>
			<a class="btn btn-success" ng-show="answered[question.id] && (canManagePosts || question.answer_period)" title="You have answered" disabled>
				Answered
			</a>
			<a class="btn btn-success" title="Evaluate Answers"
				ng-href="#/course/{{course.id}}/question/{{question.id}}/judgement" ng-show="!canManagePosts && question.judging_period && question.left" ng-disabled="question.leftover > 0">
				Evaluate
			</a>
			<a class="btn btn-success" title="Self-Evaluation"
			   ng-href="#/course/{{ course.id }}/question/{{ question.id }}/selfevaluation" ng-show="!canManagePosts && question.judging_period && !question.left && question.selfeval_left">
				Evaluate
			</a>
			<a class="btn btn-success" title="You have evaluated" ng-show="!canManagePosts && question.judging_period && !question.left && !question.selfeval_left" disabled>
				Evaluated
			</a>
			<a class="btn btn-success" title="Evaluations" ng-href="#/course/{{course.id}}/question/{{question.id}}/evaluations" ng-show="canManagePosts && (question.judging_period || question.after_judging)">
				See Evaluations
			</a>
			<p class="due-date">
				<span ng-show="question.warning && !canManagePosts">
					<!-- ({{ question.eval_left }} evaluation<span ng-if="question.eval_left != 1">s</span> available) -->
					Not enough answers are available<br />(Refresh the page to check again)
				</span>
				<span ng-show="!answered[question.id] && !canManagePosts && question.answer_period">Answer due {{question.answer_end | amDateFormat: 'MMM D'}}</span>
			</p>
		</div>
		
	</div>

</div>
